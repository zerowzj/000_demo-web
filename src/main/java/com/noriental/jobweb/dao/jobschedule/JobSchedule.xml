<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.noriental.jobweb.dao.jobschedule">
    <resultMap id="jobScheduleEO" type="JobScheduleEO">
        <result property="jsId"        column="js_id"/>
        <result property="jsJbId"      column="js_jb_id"/>
        <result property="jsStatus"    column="js_status"/>
        <result property="jsCronExp"   column="js_cron_exp"/>
        <result property="jsBeginTime" column="js_begin_time"/>
        <result property="jsNextTime" column="js_next_time"/>
        <result property="jsDesc"       column="js_desc"/>
    </resultMap>
    <resultMap id="jobScheduleVO" type="com.noriental.jobweb.dao.jobschedule.JobScheduleVO" extends="jobScheduleEO">
        <result property="jbName" column="jb_name"/>
    </resultMap>
    <sql id="Base_Column_List">
        js.js_id,
        js.js_jb_id,
        js.js_status,
        js.js_cron_exp,
        js.js_begin_time,
        js.js_next_time,
        js.js_desc
    </sql>

    <insert id="insert" useGeneratedKeys="true" keyProperty="jsId" parameterType="JobScheduleEO">
        INSERT INTO job_schedule (js_jb_id
        <if test="jsStatus != null">
            ,js_status
        </if>
        <if test="jsCronExp != null">
            ,js_cron_exp
        </if>
        <if test="jsBeginTime != null">
            ,js_begin_time
        </if>
        <if test="jsDesc != null">
            ,js_desc
        </if>
        ) VALUES (#{jsJbId}
        <if test="jsStatus != null">
            ,#{jsStatus}
        </if>
        <if test="jsCronExp != null">
            ,#{jsCronExp}
        </if>
        <if test="jsBeginTime != null">
            ,#{jsBeginTime}
        </if>
        <if test="jsDesc != null">
            ,#{jsDesc}
        </if>
        )
        <selectKey keyProperty="jsId" resultType="java.lang.Long" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <update id="update" parameterType="JobScheduleEO">
        UPDATE job_schedule
        <set>
            <if test="jsStatus != null">
                js_status = #{jsStatus},
            </if>
            <if test="jsCronExp != null">
                js_cron_exp = #{jsCronExp},
            </if>
            <if test="jsNextTime != null">
                js_next_time = #{jsNextTime},
            </if>
            <if test="jsDesc != null">
                js_desc = #{jsDesc},
            </if>
        </set>
        WHERE js_id = #{jsId}
    </update>

    <select id="get" parameterType="java.lang.Long" resultMap="jobScheduleEO">
        SELECT
        <include refid="Base_Column_List"/>
        FROM job_schedule js
        WHERE js.js_id = #{jsId}
    </select>

    <select id="getScheduleLt" parameterType="java.lang.Long" resultMap="jobScheduleEO">
        SELECT
        <include refid="Base_Column_List"/>
        FROM job_schedule js
    </select>

    <select id="getScheduleLtWithJob" parameterType="java.lang.Long" resultMap="jobScheduleVO">
        SELECT <include refid="Base_Column_List"/>,
                jb.jb_name
        FROM job_schedule js
        JOIN job_base jb ON jb.jb_id = js.js_jb_id
        <where>
            <if test="jbName != null">
                jb.jb_name = #{jbName}
            </if>
            <if test="jsStatus != null">
                js.js_status = #{jsStatus}
            </if>
        </where>
        ORDER BY js.js_id DESC
    </select>
</mapper>
